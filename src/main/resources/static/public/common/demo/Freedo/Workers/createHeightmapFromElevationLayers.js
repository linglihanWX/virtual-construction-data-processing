/**
 * Cesium - https://github.com/AnalyticalGraphicsInc/cesium
 *
 * Copyright 2011-2017 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/AnalyticalGraphicsInc/cesium/blob/master/LICENSE.md for full licensing details.
 */
/**
@license
mersenne-twister.js - https://gist.github.com/banksean/300494

   Copyright (C) 1997 - 2002, Makoto Matsumoto and Takuji Nishimura,
   All rights reserved.

   Redistribution and use in source and binary forms, with or without
   modification, are permitted provided that the following conditions
   are met:

     1. Redistributions of source code must retain the above copyright
        notice, this list of conditions and the following disclaimer.

     2. Redistributions in binary form must reproduce the above copyright
        notice, this list of conditions and the following disclaimer in the
        documentation and/or other materials provided with the distribution.

     3. The names of its contributors may not be used to endorse or promote
        products derived from this software without specific prior written
        permission.

   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
   "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
   A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
   CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
   EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
   PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
   PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
   LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
   NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
   SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

/**
  @license
  when.js - https://github.com/cujojs/when

  MIT License (c) copyright B Cavalier & J Hann

 * A lightweight CommonJS Promises/A and when() implementation
 * when is part of the cujo.js family of libraries (http://cujojs.com/)
 *
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * @version 1.7.1
 */

!function(){define("Core/defined",[],function(){"use strict";function t(t){return void 0!==t&&null!==t}return t}),define("Core/freezeObject",["./defined"],function(t){"use strict";var e=Object.freeze;return t(e)||(e=function(t){return t}),e}),define("Core/defaultValue",["./freezeObject"],function(t){"use strict";function e(t,e){return void 0!==t&&null!==t?t:e}return e.EMPTY_OBJECT=t({}),e}),define("Core/formatError",["./defined"],function(t){"use strict";function e(e){var n,r=e.name,i=e.message;n=t(r)&&t(i)?r+": "+i:e.toString();var a=e.stack;return t(a)&&(n+="\n"+a),n}return e}),define("Workers/createTaskProcessorWorker",["../Core/defaultValue","../Core/defined","../Core/formatError"],function(t,e,n){"use strict";function r(r){var i,a=[],o={id:void 0,result:void 0,error:void 0};return function(u){var s=u.data;a.length=0,o.id=s.id,o.error=void 0,o.result=void 0;try{o.result=r(s.parameters,a)}catch(t){t instanceof Error?o.error={name:t.name,message:t.message,stack:t.stack}:o.error=t}e(i)||(i=t(self.webkitPostMessage,self.postMessage)),s.canTransferArrayBuffer||(a.length=0);try{i(o,a)}catch(t){o.result=void 0,o.error="postMessage failed with error: "+n(t)+"\n  with responseMessage: "+JSON.stringify(o),i(o)}}}return r}),define("Core/DeveloperError",["./defined"],function(t){"use strict";function e(t){this.name="DeveloperError",this.message=t;var e;try{throw new Error}catch(t){e=t.stack}this.stack=e}return t(Object.create)&&(e.prototype=Object.create(Error.prototype),e.prototype.constructor=e),e.prototype.toString=function(){var e=this.name+": "+this.message;return t(this.stack)&&(e+="\n"+this.stack.toString()),e},e.throwInstantiationError=function(){throw new e("This function defines an interface and should not be called directly.")},e}),define("Core/Check",["./defined","./DeveloperError"],function(t,e){"use strict";function n(t){return t+" is required, actual value was undefined"}function r(t,e,n){return"Expected "+n+" to be typeof "+e+", actual typeof was "+t}var i={};return i.typeOf={},i.defined=function(r,i){if(!t(i))throw new e(n(r))},i.typeOf.func=function(t,n){if("function"!=typeof n)throw new e(r(typeof n,"function",t))},i.typeOf.string=function(t,n){if("string"!=typeof n)throw new e(r(typeof n,"string",t))},i.typeOf.number=function(t,n){if("number"!=typeof n)throw new e(r(typeof n,"number",t))},i.typeOf.number.lessThan=function(t,n,r){if(i.typeOf.number(t,n),n>=r)throw new e("Expected "+t+" to be less than "+r+", actual value was "+n)},i.typeOf.number.lessThanOrEquals=function(t,n,r){if(i.typeOf.number(t,n),n>r)throw new e("Expected "+t+" to be less than or equal to "+r+", actual value was "+n)},i.typeOf.number.greaterThan=function(t,n,r){if(i.typeOf.number(t,n),n<=r)throw new e("Expected "+t+" to be greater than "+r+", actual value was "+n)},i.typeOf.number.greaterThanOrEquals=function(t,n,r){if(i.typeOf.number(t,n),n<r)throw new e("Expected "+t+" to be greater than or equal to"+r+", actual value was "+n)},i.typeOf.object=function(t,n){if("object"!=typeof n)throw new e(r(typeof n,"object",t))},i.typeOf.bool=function(t,n){if("boolean"!=typeof n)throw new e(r(typeof n,"boolean",t))},i.typeOf.number.equals=function(t,n,r,a){if(i.typeOf.number(t,r),i.typeOf.number(n,a),r!==a)throw new e(t+" must be equal to "+n+", the actual values are "+r+" and "+a)},i}),define("ThirdParty/mersenne-twister",[],function(){var t=function(t){void 0==t&&(t=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,this.init_genrand(t)};return t.prototype.init_genrand=function(t){for(this.mt[0]=t>>>0,this.mti=1;this.mti<this.N;this.mti++){var t=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&t)>>>16)<<16)+1812433253*(65535&t)+this.mti,this.mt[this.mti]>>>=0}},t.prototype.genrand_int32=function(){var t,e=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var n;for(this.mti==this.N+1&&this.init_genrand(5489),n=0;n<this.N-this.M;n++)t=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+this.M]^t>>>1^e[1&t];for(;n<this.N-1;n++)t=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+(this.M-this.N)]^t>>>1^e[1&t];t=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^t>>>1^e[1&t],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,(t^=t>>>18)>>>0},t.prototype.random=function(){return this.genrand_int32()*(1/4294967296)},t}),define("Core/Math",["../ThirdParty/mersenne-twister","./defaultValue","./defined","./DeveloperError"],function(t,e,n,r){"use strict";var i={};i.EPSILON1=.1,i.EPSILON2=.01,i.EPSILON3=.001,i.EPSILON4=1e-4,i.EPSILON5=1e-5,i.EPSILON6=1e-6,i.EPSILON7=1e-7,i.EPSILON8=1e-8,i.EPSILON9=1e-9,i.EPSILON10=1e-10,i.EPSILON11=1e-11,i.EPSILON12=1e-12,i.EPSILON13=1e-13,i.EPSILON14=1e-14,i.EPSILON15=1e-15,i.EPSILON16=1e-16,i.EPSILON17=1e-17,i.EPSILON18=1e-18,i.EPSILON19=1e-19,i.EPSILON20=1e-20,i.GRAVITATIONALPARAMETER=3986004418e5,i.SOLAR_RADIUS=6955e5,i.LUNAR_RADIUS=1737400,i.SIXTY_FOUR_KILOBYTES=65536,i.sign=function(t){return t>0?1:t<0?-1:0},i.signNotZero=function(t){return t<0?-1:1},i.toSNorm=function(t,n){return n=e(n,255),Math.round((.5*i.clamp(t,-1,1)+.5)*n)},i.fromSNorm=function(t,n){return n=e(n,255),i.clamp(t,0,n)/n*2-1},i.sinh=function(t){return.5*(Math.pow(Math.E,t)-Math.pow(Math.E,-1*t))},i.cosh=function(t){return.5*(Math.pow(Math.E,t)+Math.pow(Math.E,-1*t))},i.lerp=function(t,e,n){return(1-n)*t+n*e},i.PI=Math.PI,i.ONE_OVER_PI=1/Math.PI,i.PI_OVER_TWO=.5*Math.PI,i.PI_OVER_THREE=Math.PI/3,i.PI_OVER_FOUR=Math.PI/4,i.PI_OVER_SIX=Math.PI/6,i.THREE_PI_OVER_TWO=3*Math.PI*.5,i.TWO_PI=2*Math.PI,i.ONE_OVER_TWO_PI=1/(2*Math.PI),i.RADIANS_PER_DEGREE=Math.PI/180,i.DEGREES_PER_RADIAN=180/Math.PI,i.RADIANS_PER_ARCSECOND=i.RADIANS_PER_DEGREE/3600,i.toRadians=function(t){return t*i.RADIANS_PER_DEGREE},i.toDegrees=function(t){return t*i.DEGREES_PER_RADIAN},i.convertLongitudeRange=function(t){var e=i.TWO_PI,n=t-Math.floor(t/e)*e;return n<-Math.PI?n+e:n>=Math.PI?n-e:n},i.clampToLatitudeRange=function(t){return i.clamp(t,-1*i.PI_OVER_TWO,i.PI_OVER_TWO)},i.negativePiToPi=function(t){return i.zeroToTwoPi(t+i.PI)-i.PI},i.zeroToTwoPi=function(t){var e=i.mod(t,i.TWO_PI);return Math.abs(e)<i.EPSILON14&&Math.abs(t)>i.EPSILON14?i.TWO_PI:e},i.mod=function(t,e){return(t%e+e)%e},i.equalsEpsilon=function(t,n,r,i){i=e(i,r);var a=Math.abs(t-n);return a<=i||a<=r*Math.max(Math.abs(t),Math.abs(n))};var a=[1];i.factorial=function(t){var e=a.length;if(t>=e)for(var n=a[e-1],r=e;r<=t;r++)a.push(n*r);return a[t]},i.incrementWrap=function(t,n,r){return r=e(r,0),++t,t>n&&(t=r),t},i.isPowerOfTwo=function(t){return 0!==t&&0==(t&t-1)},i.nextPowerOfTwo=function(t){return--t,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},i.clamp=function(t,e,n){return t<e?e:t>n?n:t};var o=new t;return i.setRandomNumberSeed=function(e){o=new t(e)},i.nextRandomNumber=function(){return o.random()},i.randomBetween=function(t,e){return i.nextRandomNumber()*(e-t)+t},i.acosClamped=function(t){return Math.acos(i.clamp(t,-1,1))},i.asinClamped=function(t){return Math.asin(i.clamp(t,-1,1))},i.chordLength=function(t,e){return 2*e*Math.sin(.5*t)},i.logBase=function(t,e){return Math.log(t)/Math.log(e)},i.fog=function(t,e){var n=t*e;return 1-Math.exp(-n*n)},i}),define("Core/Cartesian3",["./Check","./defaultValue","./defined","./DeveloperError","./freezeObject","./Math"],function(t,e,n,r,i,a){"use strict";function o(t,n,r){this.x=e(t,0),this.y=e(n,0),this.z=e(r,0)}o.fromSpherical=function(t,r){n(r)||(r=new o);var i=t.clock,a=t.cone,u=e(t.magnitude,1),s=u*Math.sin(a);return r.x=s*Math.cos(i),r.y=s*Math.sin(i),r.z=u*Math.cos(a),r},o.fromElements=function(t,e,r,i){return n(i)?(i.x=t,i.y=e,i.z=r,i):new o(t,e,r)},o.clone=function(t,e){if(n(t))return n(e)?(e.x=t.x,e.y=t.y,e.z=t.z,e):new o(t.x,t.y,t.z)},o.fromCartesian4=o.clone,o.packedLength=3,o.pack=function(t,n,r){return r=e(r,0),n[r++]=t.x,n[r++]=t.y,n[r]=t.z,n},o.unpack=function(t,r,i){return r=e(r,0),n(i)||(i=new o),i.x=t[r++],i.y=t[r++],i.z=t[r],i},o.packArray=function(t,e){var r=t.length;n(e)?e.length=3*r:e=new Array(3*r);for(var i=0;i<r;++i)o.pack(t[i],e,3*i);return e},o.unpackArray=function(t,e){var r=t.length;n(e)?e.length=r/3:e=new Array(r/3);for(var i=0;i<r;i+=3){var a=i/3;e[a]=o.unpack(t,i,e[a])}return e},o.fromArray=o.unpack,o.maximumComponent=function(t){return Math.max(t.x,t.y,t.z)},o.minimumComponent=function(t){return Math.min(t.x,t.y,t.z)},o.minimumByComponent=function(t,e,n){return n.x=Math.min(t.x,e.x),n.y=Math.min(t.y,e.y),n.z=Math.min(t.z,e.z),n},o.maximumByComponent=function(t,e,n){return n.x=Math.max(t.x,e.x),n.y=Math.max(t.y,e.y),n.z=Math.max(t.z,e.z),n},o.magnitudeSquared=function(t){return t.x*t.x+t.y*t.y+t.z*t.z},o.magnitude=function(t){return Math.sqrt(o.magnitudeSquared(t))};var u=new o;o.distance=function(t,e){return o.subtract(t,e,u),o.magnitude(u)},o.distanceSquared=function(t,e){return o.subtract(t,e,u),o.magnitudeSquared(u)},o.normalize=function(t,e){var n=o.magnitude(t);return e.x=t.x/n,e.y=t.y/n,e.z=t.z/n,e},o.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},o.multiplyComponents=function(t,e,n){return n.x=t.x*e.x,n.y=t.y*e.y,n.z=t.z*e.z,n},o.divideComponents=function(t,e,n){return n.x=t.x/e.x,n.y=t.y/e.y,n.z=t.z/e.z,n},o.add=function(t,e,n){return n.x=t.x+e.x,n.y=t.y+e.y,n.z=t.z+e.z,n},o.subtract=function(t,e,n){return n.x=t.x-e.x,n.y=t.y-e.y,n.z=t.z-e.z,n},o.multiplyByScalar=function(t,e,n){return n.x=t.x*e,n.y=t.y*e,n.z=t.z*e,n},o.divideByScalar=function(t,e,n){return n.x=t.x/e,n.y=t.y/e,n.z=t.z/e,n},o.negate=function(t,e){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e},o.abs=function(t,e){return e.x=Math.abs(t.x),e.y=Math.abs(t.y),e.z=Math.abs(t.z),e};var s=new o;o.lerp=function(t,e,n,r){return o.multiplyByScalar(e,n,s),r=o.multiplyByScalar(t,1-n,r),o.add(s,r,r)};var c=new o,h=new o;o.angleBetween=function(t,e){o.normalize(t,c),o.normalize(e,h);var n=o.dot(c,h),r=o.magnitude(o.cross(c,h,c));return Math.atan2(r,n)};var l=new o;o.mostOrthogonalAxis=function(t,e){var n=o.normalize(t,l);return o.abs(n,n),e=n.x<=n.y?n.x<=n.z?o.clone(o.UNIT_X,e):o.clone(o.UNIT_Z,e):n.y<=n.z?o.clone(o.UNIT_Y,e):o.clone(o.UNIT_Z,e)},o.projectVector=function(t,e,n){var r=o.dot(t,e)/o.dot(e,e);return o.multiplyByScalar(e,r,n)},o.equals=function(t,e){return t===e||n(t)&&n(e)&&t.x===e.x&&t.y===e.y&&t.z===e.z},o.equalsArray=function(t,e,n){return t.x===e[n]&&t.y===e[n+1]&&t.z===e[n+2]},o.equalsEpsilon=function(t,e,r,i){return t===e||n(t)&&n(e)&&a.equalsEpsilon(t.x,e.x,r,i)&&a.equalsEpsilon(t.y,e.y,r,i)&&a.equalsEpsilon(t.z,e.z,r,i)},o.cross=function(t,e,n){var r=t.x,i=t.y,a=t.z,o=e.x,u=e.y,s=e.z,c=i*s-a*u,h=a*o-r*s,l=r*u-i*o;return n.x=c,n.y=h,n.z=l,n},o.fromDegrees=function(t,e,n,r,i){return t=a.toRadians(t),e=a.toRadians(e),o.fromRadians(t,e,n,r,i)};var f=new o,d=new o,m=new o(40680631590769,40680631590769,40408299984661.445);return o.fromRadians=function(t,r,i,a,u){i=e(i,0);var s=n(a)?a.radiiSquared:m,c=Math.cos(r);f.x=c*Math.cos(t),f.y=c*Math.sin(t),f.z=Math.sin(r),f=o.normalize(f,f),o.multiplyComponents(s,f,d);var h=Math.sqrt(o.dot(f,d));return d=o.divideByScalar(d,h,d),f=o.multiplyByScalar(f,i,f),n(u)||(u=new o),o.add(d,f,u)},o.fromDegreesArray=function(t,e,r){var i=t.length;n(r)?r.length=i/2:r=new Array(i/2);for(var a=0;a<i;a+=2){var u=t[a],s=t[a+1],c=a/2;r[c]=o.fromDegrees(u,s,0,e,r[c])}return r},o.fromRadiansArray=function(t,e,r){var i=t.length;n(r)?r.length=i/2:r=new Array(i/2);for(var a=0;a<i;a+=2){var u=t[a],s=t[a+1],c=a/2;r[c]=o.fromRadians(u,s,0,e,r[c])}return r},o.fromDegreesArrayHeights=function(t,e,r){var i=t.length;n(r)?r.length=i/3:r=new Array(i/3);for(var a=0;a<i;a+=3){var u=t[a],s=t[a+1],c=t[a+2],h=a/3;r[h]=o.fromDegrees(u,s,c,e,r[h])}return r},o.fromRadiansArrayHeights=function(t,e,r){var i=t.length;n(r)?r.length=i/3:r=new Array(i/3);for(var a=0;a<i;a+=3){var u=t[a],s=t[a+1],c=t[a+2],h=a/3;r[h]=o.fromRadians(u,s,c,e,r[h])}return r},o.ZERO=i(new o(0,0,0)),o.UNIT_X=i(new o(1,0,0)),o.UNIT_Y=i(new o(0,1,0)),o.UNIT_Z=i(new o(0,0,1)),o.prototype.clone=function(t){return o.clone(this,t)},o.prototype.equals=function(t){return o.equals(this,t)},o.prototype.equalsEpsilon=function(t,e,n){return o.equalsEpsilon(this,t,e,n)},o.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},o}),define("Core/scaleToGeodeticSurface",["./Cartesian3","./defined","./DeveloperError","./Math"],function(t,e,n,r){"use strict";function i(n,i,u,s,c){var h=n.x,l=n.y,f=n.z,d=i.x,m=i.y,p=i.z,g=h*h*d*d,y=l*l*m*m,v=f*f*p*p,w=g+y+v,M=Math.sqrt(1/w),x=t.multiplyByScalar(n,M,a);if(w<s)return isFinite(M)?t.clone(x,c):void 0;var _=u.x,O=u.y,E=u.z,R=o;R.x=x.x*_*2,R.y=x.y*O*2,R.z=x.z*E*2;var S,b,I,T,P,L,A,C,N,z,q,W=(1-M)*t.magnitude(n)/(.5*t.magnitude(R)),D=0;do{W-=D,I=1/(1+W*_),T=1/(1+W*O),P=1/(1+W*E),L=I*I,A=T*T,C=P*P,N=L*I,z=A*T,q=C*P,S=g*L+y*A+v*C-1,b=g*N*_+y*z*O+v*q*E;D=S/(-2*b)}while(Math.abs(S)>r.EPSILON12);return e(c)?(c.x=h*I,c.y=l*T,c.z=f*P,c):new t(h*I,l*T,f*P)}var a=new t,o=new t;return i}),define("Core/Cartographic",["./Cartesian3","./Check","./defaultValue","./defined","./freezeObject","./Math","./scaleToGeodeticSurface"],function(t,e,n,r,i,a,o){"use strict";function u(t,e,r){this.longitude=n(t,0),this.latitude=n(e,0),this.height=n(r,0)}u.fromRadians=function(t,e,i,a){return i=n(i,0),r(a)?(a.longitude=t,a.latitude=e,a.height=i,a):new u(t,e,i)},u.fromDegrees=function(t,e,n,r){return t=a.toRadians(t),e=a.toRadians(e),u.fromRadians(t,e,n,r)};var s=new t,c=new t,h=new t,l=new t(1/6378137,1/6378137,1/6356752.314245179),f=new t(1/40680631590769,1/40680631590769,1/40408299984661.445),d=a.EPSILON1;return u.fromCartesian=function(e,n,i){var m=r(n)?n.oneOverRadii:l,p=r(n)?n.oneOverRadiiSquared:f,g=r(n)?n._centerToleranceSquared:d,y=o(e,m,p,g,c);if(r(y)){var v=t.multiplyComponents(y,p,s);v=t.normalize(v,v);var w=t.subtract(e,y,h),M=Math.atan2(v.y,v.x),x=Math.asin(v.z),_=a.sign(t.dot(w,e))*t.magnitude(w);return r(i)?(i.longitude=M,i.latitude=x,i.height=_,i):new u(M,x,_)}},u.toCartesian=function(e,n,r){return t.fromRadians(e.longitude,e.latitude,e.height,n,r)},u.clone=function(t,e){if(r(t))return r(e)?(e.longitude=t.longitude,e.latitude=t.latitude,e.height=t.height,e):new u(t.longitude,t.latitude,t.height)},u.equals=function(t,e){return t===e||r(t)&&r(e)&&t.longitude===e.longitude&&t.latitude===e.latitude&&t.height===e.height},u.equalsEpsilon=function(t,e,n){return t===e||r(t)&&r(e)&&Math.abs(t.longitude-e.longitude)<=n&&Math.abs(t.latitude-e.latitude)<=n&&Math.abs(t.height-e.height)<=n},u.ZERO=i(new u(0,0,0)),u.prototype.clone=function(t){return u.clone(this,t)},u.prototype.equals=function(t){return u.equals(this,t)},u.prototype.equalsEpsilon=function(t,e){return u.equalsEpsilon(this,t,e)},u.prototype.toString=function(){return"("+this.longitude+", "+this.latitude+", "+this.height+")"},u}),define("Core/defineProperties",["./defined"],function(t){"use strict";var e=function(){try{return"x"in Object.defineProperty({},"x",{})}catch(t){return!1}}(),n=Object.defineProperties;return e&&t(n)||(n=function(t){return t}),n}),define("Core/Ellipsoid",["./Cartesian3","./Cartographic","./Check","./defaultValue","./defined","./defineProperties","./DeveloperError","./freezeObject","./Math","./scaleToGeodeticSurface"],function(t,e,n,r,i,a,o,u,s,c){"use strict";function h(e,n,i,a){n=r(n,0),i=r(i,0),a=r(a,0),e._radii=new t(n,i,a),e._radiiSquared=new t(n*n,i*i,a*a),e._radiiToTheFourth=new t(n*n*n*n,i*i*i*i,a*a*a*a),e._oneOverRadii=new t(0===n?0:1/n,0===i?0:1/i,0===a?0:1/a),e._oneOverRadiiSquared=new t(0===n?0:1/(n*n),0===i?0:1/(i*i),0===a?0:1/(a*a)),e._minimumRadius=Math.min(n,i,a),e._maximumRadius=Math.max(n,i,a),e._centerToleranceSquared=s.EPSILON1,0!==e._radiiSquared.z&&(e._squaredXOverSquaredZ=e._radiiSquared.x/e._radiiSquared.z)}function l(t,e,n){this._radii=void 0,this._radiiSquared=void 0,this._radiiToTheFourth=void 0,this._oneOverRadii=void 0,this._oneOverRadiiSquared=void 0,this._minimumRadius=void 0,this._maximumRadius=void 0,this._centerToleranceSquared=void 0,this._squaredXOverSquaredZ=void 0,h(this,t,e,n)}a(l.prototype,{radii:{get:function(){return this._radii}},radiiSquared:{get:function(){return this._radiiSquared}},radiiToTheFourth:{get:function(){return this._radiiToTheFourth}},oneOverRadii:{get:function(){return this._oneOverRadii}},oneOverRadiiSquared:{get:function(){return this._oneOverRadiiSquared}},minimumRadius:{get:function(){return this._minimumRadius}},maximumRadius:{get:function(){return this._maximumRadius}}}),l.clone=function(e,n){if(i(e)){var r=e._radii;return i(n)?(t.clone(r,n._radii),t.clone(e._radiiSquared,n._radiiSquared),t.clone(e._radiiToTheFourth,n._radiiToTheFourth),t.clone(e._oneOverRadii,n._oneOverRadii),t.clone(e._oneOverRadiiSquared,n._oneOverRadiiSquared),n._minimumRadius=e._minimumRadius,n._maximumRadius=e._maximumRadius,n._centerToleranceSquared=e._centerToleranceSquared,n):new l(r.x,r.y,r.z)}},l.fromCartesian3=function(t,e){return i(e)||(e=new l),i(t)?(h(e,t.x,t.y,t.z),e):e},l.WGS84=u(new l(6378137,6378137,6356752.314245179)),l.UNIT_SPHERE=u(new l(1,1,1)),l.MOON=u(new l(s.LUNAR_RADIUS,s.LUNAR_RADIUS,s.LUNAR_RADIUS)),l.prototype.clone=function(t){return l.clone(this,t)},l.packedLength=t.packedLength,l.pack=function(e,n,i){return i=r(i,0),t.pack(e._radii,n,i),n},l.unpack=function(e,n,i){n=r(n,0);var a=t.unpack(e,n);return l.fromCartesian3(a,i)},l.prototype.geocentricSurfaceNormal=t.normalize,l.prototype.geodeticSurfaceNormalCartographic=function(e,n){var r=e.longitude,a=e.latitude,o=Math.cos(a),u=o*Math.cos(r),s=o*Math.sin(r),c=Math.sin(a);return i(n)||(n=new t),n.x=u,n.y=s,n.z=c,t.normalize(n,n)},l.prototype.geodeticSurfaceNormal=function(e,n){return i(n)||(n=new t),n=t.multiplyComponents(e,this._oneOverRadiiSquared,n),t.normalize(n,n)};var f=new t,d=new t;l.prototype.cartographicToCartesian=function(e,n){var r=f,a=d;this.geodeticSurfaceNormalCartographic(e,r),t.multiplyComponents(this._radiiSquared,r,a);var o=Math.sqrt(t.dot(r,a));return t.divideByScalar(a,o,a),t.multiplyByScalar(r,e.height,r),i(n)||(n=new t),t.add(a,r,n)},l.prototype.cartographicArrayToCartesianArray=function(t,e){var n=t.length;i(e)?e.length=n:e=new Array(n);for(var r=0;r<n;r++)e[r]=this.cartographicToCartesian(t[r],e[r]);return e};var m=new t,p=new t,g=new t;return l.prototype.cartesianToCartographic=function(n,r){var a=this.scaleToGeodeticSurface(n,p);if(i(a)){var o=this.geodeticSurfaceNormal(a,m),u=t.subtract(n,a,g),c=Math.atan2(o.y,o.x),h=Math.asin(o.z),l=s.sign(t.dot(u,n))*t.magnitude(u);return i(r)?(r.longitude=c,r.latitude=h,r.height=l,r):new e(c,h,l)}},l.prototype.cartesianArrayToCartographicArray=function(t,e){var n=t.length;i(e)?e.length=n:e=new Array(n);for(var r=0;r<n;++r)e[r]=this.cartesianToCartographic(t[r],e[r]);return e},l.prototype.scaleToGeodeticSurface=function(t,e){return c(t,this._oneOverRadii,this._oneOverRadiiSquared,this._centerToleranceSquared,e)},l.prototype.scaleToGeocentricSurface=function(e,n){i(n)||(n=new t);var r=e.x,a=e.y,o=e.z,u=this._oneOverRadiiSquared,s=1/Math.sqrt(r*r*u.x+a*a*u.y+o*o*u.z);return t.multiplyByScalar(e,s,n)},l.prototype.transformPositionToScaledSpace=function(e,n){return i(n)||(n=new t),t.multiplyComponents(e,this._oneOverRadii,n)},l.prototype.transformPositionFromScaledSpace=function(e,n){return i(n)||(n=new t),t.multiplyComponents(e,this._radii,n)},l.prototype.equals=function(e){return this===e||i(e)&&t.equals(this._radii,e._radii)},l.prototype.toString=function(){return this._radii.toString()},l.prototype.getSurfaceNormalIntersectionWithZAxis=function(e,n,a){n=r(n,0);var o=this._squaredXOverSquaredZ;if(i(a)||(a=new t),a.x=0,a.y=0,a.z=e.z*(1-o),!(Math.abs(a.z)>=this._radii.z-n))return a},l}),define("Core/Rectangle",["./Cartographic","./Check","./defaultValue","./defined","./defineProperties","./Ellipsoid","./freezeObject","./Math"],function(t,e,n,r,i,a,o,u){"use strict";function s(t,e,r,i){this.west=n(t,0),this.south=n(e,0),this.east=n(r,0),this.north=n(i,0)}i(s.prototype,{width:{get:function(){return s.computeWidth(this)}},height:{get:function(){return s.computeHeight(this)}}}),s.packedLength=4,s.pack=function(t,e,r){return r=n(r,0),e[r++]=t.west,e[r++]=t.south,e[r++]=t.east,e[r]=t.north,e},s.unpack=function(t,e,i){return e=n(e,0),r(i)||(i=new s),i.west=t[e++],i.south=t[e++],i.east=t[e++],i.north=t[e],i},s.computeWidth=function(t){var e=t.east,n=t.west;return e<n&&(e+=u.TWO_PI),e-n},s.computeHeight=function(t){return t.north-t.south},s.fromDegrees=function(t,e,i,a,o){return t=u.toRadians(n(t,0)),e=u.toRadians(n(e,0)),i=u.toRadians(n(i,0)),a=u.toRadians(n(a,0)),r(o)?(o.west=t,o.south=e,o.east=i,o.north=a,o):new s(t,e,i,a)},s.fromRadians=function(t,e,i,a,o){return r(o)?(o.west=n(t,0),o.south=n(e,0),o.east=n(i,0),o.north=n(a,0),o):new s(t,e,i,a)},s.fromCartographicArray=function(t,e){for(var n=Number.MAX_VALUE,i=-Number.MAX_VALUE,a=Number.MAX_VALUE,o=-Number.MAX_VALUE,c=Number.MAX_VALUE,h=-Number.MAX_VALUE,l=0,f=t.length;l<f;l++){var d=t[l];n=Math.min(n,d.longitude),i=Math.max(i,d.longitude),c=Math.min(c,d.latitude),h=Math.max(h,d.latitude);var m=d.longitude>=0?d.longitude:d.longitude+u.TWO_PI;a=Math.min(a,m),o=Math.max(o,m)}return i-n>o-a&&(n=a,i=o,i>u.PI&&(i-=u.TWO_PI),n>u.PI&&(n-=u.TWO_PI)),r(e)?(e.west=n,e.south=c,e.east=i,e.north=h,e):new s(n,c,i,h)},s.fromCartesianArray=function(t,e,i){e=n(e,a.WGS84);for(var o=Number.MAX_VALUE,c=-Number.MAX_VALUE,h=Number.MAX_VALUE,l=-Number.MAX_VALUE,f=Number.MAX_VALUE,d=-Number.MAX_VALUE,m=0,p=t.length;m<p;m++){var g=e.cartesianToCartographic(t[m]);o=Math.min(o,g.longitude),c=Math.max(c,g.longitude),f=Math.min(f,g.latitude),d=Math.max(d,g.latitude);var y=g.longitude>=0?g.longitude:g.longitude+u.TWO_PI;h=Math.min(h,y),l=Math.max(l,y)}return c-o>l-h&&(o=h,c=l,c>u.PI&&(c-=u.TWO_PI),o>u.PI&&(o-=u.TWO_PI)),r(i)?(i.west=o,i.south=f,i.east=c,i.north=d,i):new s(o,f,c,d)},s.clone=function(t,e){if(r(t))return r(e)?(e.west=t.west,e.south=t.south,e.east=t.east,e.north=t.north,e):new s(t.west,t.south,t.east,t.north)},s.prototype.clone=function(t){return s.clone(this,t)},s.prototype.equals=function(t){return s.equals(this,t)},s.equals=function(t,e){return t===e||r(t)&&r(e)&&t.west===e.west&&t.south===e.south&&t.east===e.east&&t.north===e.north},s.prototype.equalsEpsilon=function(t,e){return r(t)&&Math.abs(this.west-t.west)<=e&&Math.abs(this.south-t.south)<=e&&Math.abs(this.east-t.east)<=e&&Math.abs(this.north-t.north)<=e},s.validate=function(t){},s.southwest=function(e,n){return r(n)?(n.longitude=e.west,n.latitude=e.south,n.height=0,n):new t(e.west,e.south)},s.northwest=function(e,n){return r(n)?(n.longitude=e.west,n.latitude=e.north,n.height=0,n):new t(e.west,e.north)},s.northeast=function(e,n){return r(n)?(n.longitude=e.east,n.latitude=e.north,n.height=0,n):new t(e.east,e.north)},s.southeast=function(e,n){return r(n)?(n.longitude=e.east,n.latitude=e.south,n.height=0,n):new t(e.east,e.south)},s.center=function(e,n){var i=e.east,a=e.west;i<a&&(i+=u.TWO_PI);var o=u.negativePiToPi(.5*(a+i)),s=.5*(e.south+e.north);return r(n)?(n.longitude=o,n.latitude=s,n.height=0,n):new t(o,s)},s.intersection=function(t,e,n){var i=t.east,a=t.west,o=e.east,c=e.west;i<a&&o>0?i+=u.TWO_PI:o<c&&i>0&&(o+=u.TWO_PI),i<a&&c<0?c+=u.TWO_PI:o<c&&a<0&&(a+=u.TWO_PI);var h=u.negativePiToPi(Math.max(a,c)),l=u.negativePiToPi(Math.min(i,o));if(!((t.west<t.east||e.west<e.east)&&l<=h)){var f=Math.max(t.south,e.south),d=Math.min(t.north,e.north);if(!(f>=d))return r(n)?(n.west=h,n.south=f,n.east=l,n.north=d,n):new s(h,f,l,d)}},s.simpleIntersection=function(t,e,n){var i=Math.max(t.west,e.west),a=Math.max(t.south,e.south),o=Math.min(t.east,e.east),u=Math.min(t.north,e.north);if(!(a>=u||i>=o))return r(n)?(n.west=i,n.south=a,n.east=o,n.north=u,n):new s(i,a,o,u)},s.union=function(t,e,n){r(n)||(n=new s);var i=t.east,a=t.west,o=e.east,c=e.west;i<a&&o>0?i+=u.TWO_PI:o<c&&i>0&&(o+=u.TWO_PI),i<a&&c<0?c+=u.TWO_PI:o<c&&a<0&&(a+=u.TWO_PI);var h=u.convertLongitudeRange(Math.min(a,c)),l=u.convertLongitudeRange(Math.max(i,o));return n.west=h,n.south=Math.min(t.south,e.south),n.east=l,n.north=Math.max(t.north,e.north),n},s.expand=function(t,e,n){return r(n)||(n=new s),n.west=Math.min(t.west,e.longitude),n.south=Math.min(t.south,e.latitude),n.east=Math.max(t.east,e.longitude),n.north=Math.max(t.north,e.latitude),n},s.contains=function(t,e){var n=e.longitude,r=e.latitude,i=t.west,a=t.east;return a<i&&(a+=u.TWO_PI,n<0&&(n+=u.TWO_PI)),(n>i||u.equalsEpsilon(n,i,u.EPSILON14))&&(n<a||u.equalsEpsilon(n,a,u.EPSILON14))&&r>=t.south&&r<=t.north};var c=new t;return s.subsample=function(t,e,i,o){e=n(e,a.WGS84),i=n(i,0),r(o)||(o=[]);var h=0,l=t.north,f=t.south,d=t.east,m=t.west,p=c;p.height=i,p.longitude=m,p.latitude=l,o[h]=e.cartographicToCartesian(p,o[h]),h++,p.longitude=d,o[h]=e.cartographicToCartesian(p,o[h]),h++,p.latitude=f,o[h]=e.cartographicToCartesian(p,o[h]),h++,p.longitude=m,o[h]=e.cartographicToCartesian(p,o[h]),h++,p.latitude=l<0?l:f>0?f:0;for(var g=1;g<8;++g)p.longitude=-Math.PI+g*u.PI_OVER_TWO,s.contains(t,p)&&(o[h]=e.cartographicToCartesian(p,o[h]),h++);return 0===p.latitude&&(p.longitude=m,o[h]=e.cartographicToCartesian(p,o[h]),h++,p.longitude=d,o[h]=e.cartographicToCartesian(p,o[h]),h++),o.length=h,o},s.MAX_VALUE=o(new s(-Math.PI,-u.PI_OVER_TWO,Math.PI,u.PI_OVER_TWO)),s}),function(t){"use strict";t("ThirdParty/when",[],function(){function t(t,n,r,i){return e(t).then(n,r,i)}function e(t){var e,n;return t instanceof r?e=t:u(t)?(n=o(),t.then(function(t){n.resolve(t)},function(t){n.reject(t)},function(t){n.progress(t)}),e=n.promise):e=i(t),e}function n(e){return t(e,a)}function r(t){this.then=t}function i(t){return new r(function(n){try{return e(n?n(t):t)}catch(t){return a(t)}})}function a(t){return new r(function(n,r){try{return r?e(r(t)):a(t)}catch(t){return a(t)}})}function o(){function t(t,e,n){return f(t,e,n)}function n(t){return m(t)}function i(t){return m(a(t))}function u(t){return d(t)}var s,c,h,l,f,d,m;return c=new r(t),s={then:t,resolve:n,reject:i,progress:u,promise:c,resolver:{resolve:n,reject:i,progress:u}},h=[],l=[],f=function(t,e,n){var r,i;return r=o(),i="function"==typeof n?function(t){try{r.progress(n(t))}catch(t){r.progress(t)}}:function(t){r.progress(t)},h.push(function(n){n.then(t,e).then(r.resolve,r.reject,i)}),l.push(i),r.promise},d=function(t){return p(l,t),t},m=function(t){return t=e(t),f=t.then,m=e,d=y,p(h,t),l=h=x,t},s}function u(t){return t&&"function"==typeof t.then}function s(e,n,r,i,a){return g(2,arguments),t(e,function(e){function u(t){p(t)}function s(t){m(t)}var c,h,l,f,d,m,p,g,v,w;if(v=e.length>>>0,c=Math.max(0,Math.min(n,v)),l=[],h=v-c+1,f=[],d=o(),c)for(g=d.progress,p=function(t){f.push(t),--h||(m=p=y,d.reject(f))},m=function(t){l.push(t),--c||(m=p=y,d.resolve(l))},w=0;w<v;++w)w in e&&t(e[w],s,u,g);else d.resolve(l);return d.then(r,i,a)})}function c(t,e,n,r){function i(t){return e?e(t[0]):t[0]}return s(t,1,i,n,r)}function h(t,e,n,r){return g(1,arguments),f(t,v).then(e,n,r)}function l(){return f(arguments,v)}function f(e,n){return t(e,function(e){var r,i,a,u,s,c;if(a=i=e.length>>>0,r=[],c=o(),a)for(u=function(e,i){t(e,n).then(function(t){r[i]=t,--a||c.resolve(r)},c.reject)},s=0;s<i;s++)s in e?u(e[s],s):--a;else c.resolve(r);return c.promise})}function d(e,n){var r=M.call(arguments,1);return t(e,function(e){var i;return i=e.length,r[0]=function(e,r,a){return t(e,function(e){return t(r,function(t){return n(e,t,a,i)})})},w.apply(e,r)})}function m(e,n,r){var i=arguments.length>2;return t(e,function(t){return t=i?r:t,n.resolve(t),t},function(t){return n.reject(t),a(t)},n.progress)}function p(t,e){for(var n,r=0;n=t[r++];)n(e)}function g(t,e){for(var n,r=e.length;r>t;)if(null!=(n=e[--r])&&"function"!=typeof n)throw new Error("arg "+r+" must be a function")}function y(){}function v(t){return t}var w,M,x;return t.defer=o,t.resolve=e,t.reject=n,t.join=l,t.all=h,t.map=f,t.reduce=d,t.any=c,t.some=s,t.chain=m,t.isPromise=u,r.prototype={always:function(t,e){return this.then(t,t,e)},otherwise:function(t){return this.then(x,t)},yield:function(t){return this.then(function(){return t})},spread:function(t){return this.then(function(e){return h(e,function(e){return t.apply(x,e)})})}},M=[].slice,w=[].reduce||function(t){var e,n,r,i,a;if(a=0,e=Object(this),i=e.length>>>0,n=arguments,n.length<=1)for(;;){if(a in e){r=e[a++];break}if(++a>=i)throw new TypeError}else r=n[1];for(;a<i;++a)a in e&&(r=t(r,e[a],a,e));return r},t})}("function"==typeof define&&define.amd?define:function(t){"object"==typeof exports?module.exports=t():this.when=t()}),define("Core/isArray",["./defined"],function(t){"use strict";var e=Array.isArray;return t(e)||(e=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),e}),define("Core/objectToQuery",["./defined","./DeveloperError","./isArray"],function(t,e,n){"use strict";function r(t){var e="";for(var r in t)if(t.hasOwnProperty(r)){var i=t[r],a=encodeURIComponent(r)+"=";if(n(i))for(var o=0,u=i.length;o<u;++o)e+=a+encodeURIComponent(i[o])+"&";else e+=a+encodeURIComponent(i)+"&"}return e=e.slice(0,-1)}return r}),define("Core/Interval",["./defaultValue"],function(t){"use strict";function e(e,n){this.start=t(e,0),this.stop=t(n,0)}return e}),define("Core/Matrix3",["./Cartesian3","./Check","./defaultValue","./defined","./defineProperties","./DeveloperError","./freezeObject","./Math"],function(t,e,n,r,i,a,o,u){"use strict";function s(t,e,r,i,a,o,u,s,c){this[0]=n(t,0),this[1]=n(i,0),this[2]=n(u,0),this[3]=n(e,0),this[4]=n(a,0),this[5]=n(s,0),this[6]=n(r,0),this[7]=n(o,0),this[8]=n(c,0)}function c(t){for(var e=0,n=0;n<9;++n){var r=t[n];e+=r*r}return Math.sqrt(e)}function h(t){for(var e=0,n=0;n<3;++n){var r=t[s.getElementIndex(p[n],m[n])];e+=2*r*r}return Math.sqrt(e)}function l(t,e){for(var n=u.EPSILON15,r=0,i=1,a=0;a<3;++a){var o=Math.abs(t[s.getElementIndex(p[a],m[a])]);o>r&&(i=a,r=o)}var c=1,h=0,l=m[i],f=p[i];if(Math.abs(t[s.getElementIndex(f,l)])>n){var d,g=t[s.getElementIndex(f,f)],y=t[s.getElementIndex(l,l)],v=t[s.getElementIndex(f,l)],w=(g-y)/2/v;d=w<0?-1/(-w+Math.sqrt(1+w*w)):1/(w+Math.sqrt(1+w*w)),c=1/Math.sqrt(1+d*d),h=d*c}return e=s.clone(s.IDENTITY,e),e[s.getElementIndex(l,l)]=e[s.getElementIndex(f,f)]=c,e[s.getElementIndex(f,l)]=h,e[s.getElementIndex(l,f)]=-h,e}s.packedLength=9,s.pack=function(t,e,r){return r=n(r,0),e[r++]=t[0],e[r++]=t[1],e[r++]=t[2],e[r++]=t[3],e[r++]=t[4],e[r++]=t[5],e[r++]=t[6],e[r++]=t[7],e[r++]=t[8],e},s.unpack=function(t,e,i){return e=n(e,0),r(i)||(i=new s),i[0]=t[e++],i[1]=t[e++],i[2]=t[e++],i[3]=t[e++],i[4]=t[e++],i[5]=t[e++],i[6]=t[e++],i[7]=t[e++],i[8]=t[e++],i},s.clone=function(t,e){if(r(t))return r(e)?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e):new s(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])},s.fromArray=function(t,e,i){return e=n(e,0),r(i)||(i=new s),i[0]=t[e],i[1]=t[e+1],i[2]=t[e+2],i[3]=t[e+3],i[4]=t[e+4],i[5]=t[e+5],i[6]=t[e+6],i[7]=t[e+7],i[8]=t[e+8],i},s.fromColumnMajorArray=function(t,e){return s.clone(t,e)},s.fromRowMajorArray=function(t,e){return r(e)?(e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e):new s(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},s.fromQuaternion=function(t,e){var n=t.x*t.x,i=t.x*t.y,a=t.x*t.z,o=t.x*t.w,u=t.y*t.y,c=t.y*t.z,h=t.y*t.w,l=t.z*t.z,f=t.z*t.w,d=t.w*t.w,m=n-u-l+d,p=2*(i-f),g=2*(a+h),y=2*(i+f),v=-n+u-l+d,w=2*(c-o),M=2*(a-h),x=2*(c+o),_=-n-u+l+d;return r(e)?(e[0]=m,e[1]=y,e[2]=M,e[3]=p,e[4]=v,e[5]=x,e[6]=g,e[7]=w,e[8]=_,e):new s(m,p,g,y,v,w,M,x,_)},s.fromHeadingPitchRoll=function(t,e){var n=Math.cos(-t.pitch),i=Math.cos(-t.heading),a=Math.cos(t.roll),o=Math.sin(-t.pitch),u=Math.sin(-t.heading),c=Math.sin(t.roll),h=n*i,l=-a*u+c*o*i,f=c*u+a*o*i,d=n*u,m=a*i+c*o*u,p=-c*i+a*o*u,g=-o,y=c*n,v=a*n;return r(e)?(e[0]=h,e[1]=d,e[2]=g,e[3]=l,e[4]=m,e[5]=y,e[6]=f,e[7]=p,e[8]=v,e):new s(h,l,f,d,m,p,g,y,v)},s.fromScale=function(t,e){return r(e)?(e[0]=t.x,e[1]=0,e[2]=0,e[3]=0,e[4]=t.y,e[5]=0,e[6]=0,e[7]=0,e[8]=t.z,
e):new s(t.x,0,0,0,t.y,0,0,0,t.z)},s.fromUniformScale=function(t,e){return r(e)?(e[0]=t,e[1]=0,e[2]=0,e[3]=0,e[4]=t,e[5]=0,e[6]=0,e[7]=0,e[8]=t,e):new s(t,0,0,0,t,0,0,0,t)},s.fromCrossProduct=function(t,e){return r(e)?(e[0]=0,e[1]=t.z,e[2]=-t.y,e[3]=-t.z,e[4]=0,e[5]=t.x,e[6]=t.y,e[7]=-t.x,e[8]=0,e):new s(0,-t.z,t.y,t.z,0,-t.x,-t.y,t.x,0)},s.fromRotationX=function(t,e){var n=Math.cos(t),i=Math.sin(t);return r(e)?(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=n,e[5]=i,e[6]=0,e[7]=-i,e[8]=n,e):new s(1,0,0,0,n,-i,0,i,n)},s.fromRotationY=function(t,e){var n=Math.cos(t),i=Math.sin(t);return r(e)?(e[0]=n,e[1]=0,e[2]=-i,e[3]=0,e[4]=1,e[5]=0,e[6]=i,e[7]=0,e[8]=n,e):new s(n,0,i,0,1,0,-i,0,n)},s.fromRotationZ=function(t,e){var n=Math.cos(t),i=Math.sin(t);return r(e)?(e[0]=n,e[1]=i,e[2]=0,e[3]=-i,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e):new s(n,-i,0,i,n,0,0,0,1)},s.toArray=function(t,e){return r(e)?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e):[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]},s.getElementIndex=function(t,e){return 3*t+e},s.getColumn=function(t,e,n){var r=3*e,i=t[r],a=t[r+1],o=t[r+2];return n.x=i,n.y=a,n.z=o,n},s.setColumn=function(t,e,n,r){r=s.clone(t,r);var i=3*e;return r[i]=n.x,r[i+1]=n.y,r[i+2]=n.z,r},s.getRow=function(t,e,n){var r=t[e],i=t[e+3],a=t[e+6];return n.x=r,n.y=i,n.z=a,n},s.setRow=function(t,e,n,r){return r=s.clone(t,r),r[e]=n.x,r[e+3]=n.y,r[e+6]=n.z,r};var f=new t;s.getScale=function(e,n){return n.x=t.magnitude(t.fromElements(e[0],e[1],e[2],f)),n.y=t.magnitude(t.fromElements(e[3],e[4],e[5],f)),n.z=t.magnitude(t.fromElements(e[6],e[7],e[8],f)),n};var d=new t;s.getMaximumScale=function(e){return s.getScale(e,d),t.maximumComponent(d)},s.multiply=function(t,e,n){var r=t[0]*e[0]+t[3]*e[1]+t[6]*e[2],i=t[1]*e[0]+t[4]*e[1]+t[7]*e[2],a=t[2]*e[0]+t[5]*e[1]+t[8]*e[2],o=t[0]*e[3]+t[3]*e[4]+t[6]*e[5],u=t[1]*e[3]+t[4]*e[4]+t[7]*e[5],s=t[2]*e[3]+t[5]*e[4]+t[8]*e[5],c=t[0]*e[6]+t[3]*e[7]+t[6]*e[8],h=t[1]*e[6]+t[4]*e[7]+t[7]*e[8],l=t[2]*e[6]+t[5]*e[7]+t[8]*e[8];return n[0]=r,n[1]=i,n[2]=a,n[3]=o,n[4]=u,n[5]=s,n[6]=c,n[7]=h,n[8]=l,n},s.add=function(t,e,n){return n[0]=t[0]+e[0],n[1]=t[1]+e[1],n[2]=t[2]+e[2],n[3]=t[3]+e[3],n[4]=t[4]+e[4],n[5]=t[5]+e[5],n[6]=t[6]+e[6],n[7]=t[7]+e[7],n[8]=t[8]+e[8],n},s.subtract=function(t,e,n){return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n[2]=t[2]-e[2],n[3]=t[3]-e[3],n[4]=t[4]-e[4],n[5]=t[5]-e[5],n[6]=t[6]-e[6],n[7]=t[7]-e[7],n[8]=t[8]-e[8],n},s.multiplyByVector=function(t,e,n){var r=e.x,i=e.y,a=e.z,o=t[0]*r+t[3]*i+t[6]*a,u=t[1]*r+t[4]*i+t[7]*a,s=t[2]*r+t[5]*i+t[8]*a;return n.x=o,n.y=u,n.z=s,n},s.multiplyByScalar=function(t,e,n){return n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n[4]=t[4]*e,n[5]=t[5]*e,n[6]=t[6]*e,n[7]=t[7]*e,n[8]=t[8]*e,n},s.multiplyByScale=function(t,e,n){return n[0]=t[0]*e.x,n[1]=t[1]*e.x,n[2]=t[2]*e.x,n[3]=t[3]*e.y,n[4]=t[4]*e.y,n[5]=t[5]*e.y,n[6]=t[6]*e.z,n[7]=t[7]*e.z,n[8]=t[8]*e.z,n},s.negate=function(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=-t[7],e[8]=-t[8],e},s.transpose=function(t,e){var n=t[0],r=t[3],i=t[6],a=t[1],o=t[4],u=t[7],s=t[2],c=t[5],h=t[8];return e[0]=n,e[1]=r,e[2]=i,e[3]=a,e[4]=o,e[5]=u,e[6]=s,e[7]=c,e[8]=h,e};var m=[1,0,0],p=[2,2,1],g=new s,y=new s;return s.computeEigenDecomposition=function(t,e){var n=u.EPSILON20,i=0,a=0;r(e)||(e={});for(var o=e.unitary=s.clone(s.IDENTITY,e.unitary),f=e.diagonal=s.clone(t,e.diagonal),d=n*c(f);a<10&&h(f)>d;)l(f,g),s.transpose(g,y),s.multiply(f,g,f),s.multiply(y,f,f),s.multiply(o,g,o),++i>2&&(++a,i=0);return e},s.abs=function(t,e){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e[3]=Math.abs(t[3]),e[4]=Math.abs(t[4]),e[5]=Math.abs(t[5]),e[6]=Math.abs(t[6]),e[7]=Math.abs(t[7]),e[8]=Math.abs(t[8]),e},s.determinant=function(t){var e=t[0],n=t[3],r=t[6],i=t[1],a=t[4],o=t[7],u=t[2],s=t[5],c=t[8];return e*(a*c-s*o)+i*(s*r-n*c)+u*(n*o-a*r)},s.inverse=function(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],u=t[5],c=t[6],h=t[7],l=t[8],f=s.determinant(t);e[0]=o*l-h*u,e[1]=h*i-r*l,e[2]=r*u-o*i,e[3]=c*u-a*l,e[4]=n*l-c*i,e[5]=a*i-n*u,e[6]=a*h-c*o,e[7]=c*r-n*h,e[8]=n*o-a*r;var d=1/f;return s.multiplyByScalar(e,d,e)},s.equals=function(t,e){return t===e||r(t)&&r(e)&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},s.equalsEpsilon=function(t,e,n){return t===e||r(t)&&r(e)&&Math.abs(t[0]-e[0])<=n&&Math.abs(t[1]-e[1])<=n&&Math.abs(t[2]-e[2])<=n&&Math.abs(t[3]-e[3])<=n&&Math.abs(t[4]-e[4])<=n&&Math.abs(t[5]-e[5])<=n&&Math.abs(t[6]-e[6])<=n&&Math.abs(t[7]-e[7])<=n&&Math.abs(t[8]-e[8])<=n},s.IDENTITY=o(new s(1,0,0,0,1,0,0,0,1)),s.ZERO=o(new s(0,0,0,0,0,0,0,0,0)),s.COLUMN0ROW0=0,s.COLUMN0ROW1=1,s.COLUMN0ROW2=2,s.COLUMN1ROW0=3,s.COLUMN1ROW1=4,s.COLUMN1ROW2=5,s.COLUMN2ROW0=6,s.COLUMN2ROW1=7,s.COLUMN2ROW2=8,i(s.prototype,{length:{get:function(){return s.packedLength}}}),s.prototype.clone=function(t){return s.clone(this,t)},s.prototype.equals=function(t){return s.equals(this,t)},s.equalsArray=function(t,e,n){return t[0]===e[n]&&t[1]===e[n+1]&&t[2]===e[n+2]&&t[3]===e[n+3]&&t[4]===e[n+4]&&t[5]===e[n+5]&&t[6]===e[n+6]&&t[7]===e[n+7]&&t[8]===e[n+8]},s.prototype.equalsEpsilon=function(t,e){return s.equalsEpsilon(this,t,e)},s.prototype.toString=function(){return"("+this[0]+", "+this[3]+", "+this[6]+")\n("+this[1]+", "+this[4]+", "+this[7]+")\n("+this[2]+", "+this[5]+", "+this[8]+")"},s}),define("Core/QuadraticRealPolynomial",["./DeveloperError","./Math"],function(t,e){"use strict";function n(t,n,r){var i=t+n;return e.sign(t)!==e.sign(n)&&Math.abs(i/Math.max(Math.abs(t),Math.abs(n)))<r?0:i}var r={};return r.computeDiscriminant=function(t,e,n){return e*e-4*t*n},r.computeRealRoots=function(t,r,i){var a;if(0===t)return 0===r?[]:[-i/r];if(0===r){if(0===i)return[0,0];var o=Math.abs(i),u=Math.abs(t);if(o<u&&o/u<e.EPSILON14)return[0,0];if(o>u&&u/o<e.EPSILON14)return[];if((a=-i/t)<0)return[];var s=Math.sqrt(a);return[-s,s]}if(0===i)return a=-r/t,a<0?[a,0]:[0,a];var c=r*r,h=4*t*i,l=n(c,-h,e.EPSILON14);if(l<0)return[];var f=-.5*n(r,e.sign(r)*Math.sqrt(l),e.EPSILON14);return r>0?[f/t,i/f]:[i/f,f/t]},r}),define("Core/CubicRealPolynomial",["./DeveloperError","./QuadraticRealPolynomial"],function(t,e){"use strict";function n(t,e,n,r){var i,a,o=t,u=e/3,s=n/3,c=r,h=o*s,l=u*c,f=u*u,d=s*s,m=o*s-f,p=o*c-u*s,g=u*c-d,y=4*m*g-p*p;if(y<0){var v,w,M;f*l>=h*d?(v=o,w=m,M=-2*u*m+o*p):(v=c,w=g,M=-c*p+2*s*g);var x=M<0?-1:1,_=-x*Math.abs(v)*Math.sqrt(-y);a=-M+_;var O=a/2,E=O<0?-Math.pow(-O,1/3):Math.pow(O,1/3),R=a===_?-E:-w/E;return i=w<=0?E+R:-M/(E*E+R*R+w),f*l>=h*d?[(i-u)/o]:[-c/(i+s)]}var S=m,b=-2*u*m+o*p,I=g,T=-c*p+2*s*g,P=Math.sqrt(y),L=Math.sqrt(3)/2,A=Math.abs(Math.atan2(o*P,-b)/3);i=2*Math.sqrt(-S);var C=Math.cos(A);a=i*C;var N=i*(-C/2-L*Math.sin(A)),z=a+N>2*u?a-u:N-u,q=o,W=z/q;A=Math.abs(Math.atan2(c*P,-T)/3),i=2*Math.sqrt(-I),C=Math.cos(A),a=i*C,N=i*(-C/2-L*Math.sin(A));var D=-c,U=a+N<2*s?a+s:N+s,B=D/U,k=q*U,V=-z*U-q*D,X=z*D,j=(s*V-u*X)/(-u*V+s*k);return W<=j?W<=B?j<=B?[W,j,B]:[W,B,j]:[B,W,j]:W<=B?[j,W,B]:j<=B?[j,B,W]:[B,j,W]}var r={};return r.computeDiscriminant=function(t,e,n,r){var i=t*t,a=e*e,o=n*n;return 18*t*e*n*r+a*o-27*i*(r*r)-4*(t*o*n+a*e*r)},r.computeRealRoots=function(t,r,i,a){var o,u;if(0===t)return e.computeRealRoots(r,i,a);if(0===r){if(0===i){if(0===a)return[0,0,0];u=-a/t;var s=u<0?-Math.pow(-u,1/3):Math.pow(u,1/3);return[s,s,s]}return 0===a?(o=e.computeRealRoots(t,0,i),0===o.Length?[0]:[o[0],0,o[1]]):n(t,0,i,a)}return 0===i?0===a?(u=-r/t,u<0?[u,0,0]:[0,0,u]):n(t,r,0,a):0===a?(o=e.computeRealRoots(t,r,i),0===o.length?[0]:o[1]<=0?[o[0],o[1],0]:o[0]>=0?[0,o[0],o[1]]:[o[0],0,o[1]]):n(t,r,i,a)},r}),define("Core/QuarticRealPolynomial",["./CubicRealPolynomial","./DeveloperError","./Math","./QuadraticRealPolynomial"],function(t,e,n,r){"use strict";function i(e,i,a,o){var u=e*e,s=i-3*u/8,c=a-i*e/2+u*e/8,h=o-a*e/4+i*u/16-3*u*u/256,l=t.computeRealRoots(1,2*s,s*s-4*h,-c*c);if(l.length>0){var f=-e/4,d=l[l.length-1];if(Math.abs(d)<n.EPSILON14){var m=r.computeRealRoots(1,s,h);if(2===m.length){var p,g=m[0],y=m[1];if(g>=0&&y>=0){var v=Math.sqrt(g),w=Math.sqrt(y);return[f-w,f-v,f+v,f+w]}if(g>=0&&y<0)return p=Math.sqrt(g),[f-p,f+p];if(g<0&&y>=0)return p=Math.sqrt(y),[f-p,f+p]}return[]}if(d>0){var M=Math.sqrt(d),x=(s+d-c/M)/2,_=(s+d+c/M)/2,O=r.computeRealRoots(1,M,x),E=r.computeRealRoots(1,-M,_);return 0!==O.length?(O[0]+=f,O[1]+=f,0!==E.length?(E[0]+=f,E[1]+=f,O[1]<=E[0]?[O[0],O[1],E[0],E[1]]:E[1]<=O[0]?[E[0],E[1],O[0],O[1]]:O[0]>=E[0]&&O[1]<=E[1]?[E[0],O[0],O[1],E[1]]:E[0]>=O[0]&&E[1]<=O[1]?[O[0],E[0],E[1],O[1]]:O[0]>E[0]&&O[0]<E[1]?[E[0],O[0],E[1],O[1]]:[O[0],E[0],O[1],E[1]]):O):0!==E.length?(E[0]+=f,E[1]+=f,E):[]}}return[]}function a(e,i,a,o){var u=a*a,s=i*i,c=e*e,h=-2*i,l=a*e+s-4*o,f=c*o-a*i*e+u,d=t.computeRealRoots(1,h,l,f);if(d.length>0){var m,p,g=d[0],y=i-g,v=y*y,w=e/2,M=y/2,x=v-4*o,_=v+4*Math.abs(o),O=c-4*g,E=c+4*Math.abs(g);if(g<0||x*E<O*_){var R=Math.sqrt(O);m=R/2,p=0===R?0:(e*M-a)/R}else{var S=Math.sqrt(x);m=0===S?0:(e*M-a)/S,p=S/2}var b,I;0===w&&0===m?(b=0,I=0):n.sign(w)===n.sign(m)?(b=w+m,I=g/b):(I=w-m,b=g/I);var T,P;0===M&&0===p?(T=0,P=0):n.sign(M)===n.sign(p)?(T=M+p,P=o/T):(P=M-p,T=o/P);var L=r.computeRealRoots(1,b,T),A=r.computeRealRoots(1,I,P);if(0!==L.length)return 0!==A.length?L[1]<=A[0]?[L[0],L[1],A[0],A[1]]:A[1]<=L[0]?[A[0],A[1],L[0],L[1]]:L[0]>=A[0]&&L[1]<=A[1]?[A[0],L[0],L[1],A[1]]:A[0]>=L[0]&&A[1]<=L[1]?[L[0],A[0],A[1],L[1]]:L[0]>A[0]&&L[0]<A[1]?[A[0],L[0],A[1],L[1]]:[L[0],A[0],L[1],A[1]]:L;if(0!==A.length)return A}return[]}var o={};return o.computeDiscriminant=function(t,e,n,r,i){var a=t*t,o=a*t,u=e*e,s=u*e,c=n*n,h=c*n,l=r*r,f=l*r,d=i*i;return u*c*l-4*s*f-4*t*h*l+18*t*e*n*f-27*a*l*l+256*o*(d*i)+i*(18*s*n*r-4*u*h+16*t*c*c-80*t*e*c*r-6*t*u*l+144*a*n*l)+d*(144*t*u*n-27*u*u-128*a*c-192*a*e*r)},o.computeRealRoots=function(e,r,o,u,s){if(Math.abs(e)<n.EPSILON15)return t.computeRealRoots(r,o,u,s);var c=r/e,h=o/e,l=u/e,f=s/e,d=c<0?1:0;switch(d+=h<0?d+1:d,d+=l<0?d+1:d,d+=f<0?d+1:d){case 0:return i(c,h,l,f);case 1:case 2:return a(c,h,l,f);case 3:case 4:return i(c,h,l,f);case 5:return a(c,h,l,f);case 6:case 7:return i(c,h,l,f);case 8:return a(c,h,l,f);case 9:case 10:return i(c,h,l,f);case 11:return a(c,h,l,f);case 12:case 13:case 14:case 15:return i(c,h,l,f);default:return}},o}),define("Core/Ray",["./Cartesian3","./defaultValue","./defined","./DeveloperError"],function(t,e,n,r){"use strict";function i(n,r){r=t.clone(e(r,t.ZERO)),t.equals(r,t.ZERO)||t.normalize(r,r),this.origin=t.clone(e(n,t.ZERO)),this.direction=r}return i.getPoint=function(e,r,i){return n(i)||(i=new t),i=t.multiplyByScalar(e.direction,r,i),t.add(e.origin,i,i)},i}),define("Core/IntersectionTests",["./Cartesian3","./Cartographic","./defaultValue","./defined","./DeveloperError","./Interval","./Math","./Matrix3","./QuadraticRealPolynomial","./QuarticRealPolynomial","./Ray"],function(t,e,n,r,i,a,o,u,s,c,h){"use strict";function l(t,e,n,r){var i=e*e-4*t*n;if(!(i<0)){if(i>0){var a=1/(2*t),o=Math.sqrt(i),u=(-e+o)*a,s=(-e-o)*a;return u<s?(r.root0=u,r.root1=s):(r.root0=s,r.root1=u),r}var c=-e/(2*t);if(0!==c)return r.root0=r.root1=c,r}}function f(e,n,i){r(i)||(i=new a);var o=e.origin,u=e.direction,s=n.center,c=n.radius*n.radius,h=t.subtract(o,s,v),f=t.dot(u,u),d=2*t.dot(u,h),m=t.magnitudeSquared(h)-c,p=l(f,d,m,_);if(r(p))return i.start=p.root0,i.stop=p.root1,i}function d(t,e,n){var r=t+e;return o.sign(t)!==o.sign(e)&&Math.abs(r/Math.max(Math.abs(t),Math.abs(e)))<n?0:r}function m(e,n,r,i,a){var h,l=i*i,f=a*a,m=(e[u.COLUMN1ROW1]-e[u.COLUMN2ROW2])*f,p=a*(i*d(e[u.COLUMN1ROW0],e[u.COLUMN0ROW1],o.EPSILON15)+n.y),g=e[u.COLUMN0ROW0]*l+e[u.COLUMN2ROW2]*f+i*n.x+r,y=f*d(e[u.COLUMN2ROW1],e[u.COLUMN1ROW2],o.EPSILON15),v=a*(i*d(e[u.COLUMN2ROW0],e[u.COLUMN0ROW2])+n.z),w=[];if(0===v&&0===y){if(h=s.computeRealRoots(m,p,g),0===h.length)return w;var M=h[0],x=Math.sqrt(Math.max(1-M*M,0));if(w.push(new t(i,a*M,a*-x)),w.push(new t(i,a*M,a*x)),2===h.length){var _=h[1],O=Math.sqrt(Math.max(1-_*_,0));w.push(new t(i,a*_,a*-O)),w.push(new t(i,a*_,a*O))}return w}var E=v*v,R=y*y,S=m*m,b=v*y,I=S+R,T=2*(p*m+b),P=2*g*m+p*p-R+E,L=2*(g*p-b),A=g*g-E;if(0===I&&0===T&&0===P&&0===L)return w;h=c.computeRealRoots(I,T,P,L,A);var C=h.length;if(0===C)return w;for(var N=0;N<C;++N){var z,q=h[N],W=q*q,D=Math.max(1-W,0),U=Math.sqrt(D);z=o.sign(m)===o.sign(g)?d(m*W+g,p*q,o.EPSILON12):o.sign(g)===o.sign(p*q)?d(m*W,p*q+g,o.EPSILON12):d(m*W+p*q,g,o.EPSILON12);var B=d(y*q,v,o.EPSILON15),k=z*B;k<0?w.push(new t(i,a*q,a*U)):k>0?w.push(new t(i,a*q,a*-U)):0!==U?(w.push(new t(i,a*q,a*-U)),w.push(new t(i,a*q,a*U)),++N):w.push(new t(i,a*q,a*U))}return w}var p={};p.rayPlane=function(e,n,i){r(i)||(i=new t);var a=e.origin,u=e.direction,s=n.normal,c=t.dot(s,u);if(!(Math.abs(c)<o.EPSILON15)){var h=(-n.distance-t.dot(s,a))/c;if(!(h<0))return i=t.multiplyByScalar(u,h,i),t.add(a,i,i)}};var g=new t,y=new t,v=new t,w=new t,M=new t;p.rayTriangleParametric=function(e,r,i,a,u){u=n(u,!1);var s,c,h,l,f,d=e.origin,m=e.direction,p=t.subtract(i,r,g),x=t.subtract(a,r,y),_=t.cross(m,x,v),O=t.dot(p,_);if(u){if(O<o.EPSILON6)return;if(s=t.subtract(d,r,w),(h=t.dot(s,_))<0||h>O)return;if(c=t.cross(s,p,M),(l=t.dot(m,c))<0||h+l>O)return;f=t.dot(x,c)/O}else{if(Math.abs(O)<o.EPSILON6)return;var E=1/O;if(s=t.subtract(d,r,w),(h=t.dot(s,_)*E)<0||h>1)return;if(c=t.cross(s,p,M),(l=t.dot(m,c)*E)<0||h+l>1)return;f=t.dot(x,c)*E}return f},p.rayTriangle=function(e,n,i,a,o,u){var s=p.rayTriangleParametric(e,n,i,a,o);if(r(s)&&!(s<0))return r(u)||(u=new t),t.multiplyByScalar(e.direction,s,u),t.add(e.origin,u,u)};var x=new h;p.lineSegmentTriangle=function(e,n,i,a,o,u,s){var c=x;t.clone(e,c.origin),t.subtract(n,e,c.direction),t.normalize(c.direction,c.direction);var h=p.rayTriangleParametric(c,i,a,o,u);if(!(!r(h)||h<0||h>t.distance(e,n)))return r(s)||(s=new t),t.multiplyByScalar(c.direction,h,s),t.add(c.origin,s,s)};var _={root0:0,root1:0};p.raySphere=function(t,e,n){if(n=f(t,e,n),r(n)&&!(n.stop<0))return n.start=Math.max(n.start,0),n};var O=new h;p.lineSegmentSphere=function(e,n,i,a){var o=O;t.clone(e,o.origin);var u=t.subtract(n,e,o.direction),s=t.magnitude(u);if(t.normalize(u,u),a=f(o,i,a),!(!r(a)||a.stop<0||a.start>s))return a.start=Math.max(a.start,0),a.stop=Math.min(a.stop,s),a};var E=new t,R=new t;p.rayEllipsoid=function(e,n){var r,i,o,u,s,c=n.oneOverRadii,h=t.multiplyComponents(c,e.origin,E),l=t.multiplyComponents(c,e.direction,R),f=t.magnitudeSquared(h),d=t.dot(h,l);if(f>1){if(d>=0)return;var m=d*d;if(r=f-1,i=t.magnitudeSquared(l),o=i*r,m<o)return;if(m>o){u=d*d-o,s=-d+Math.sqrt(u);var p=s/i,g=r/s;return p<g?new a(p,g):{start:g,stop:p}}var y=Math.sqrt(r/i);return new a(y,y)}return f<1?(r=f-1,i=t.magnitudeSquared(l),o=i*r,u=d*d-o,s=-d+Math.sqrt(u),new a(0,s/i)):d<0?(i=t.magnitudeSquared(l),new a(0,-d/i)):void 0};var S=new t,b=new t,I=new t,T=new t,P=new t,L=new u,A=new u,C=new u,N=new u,z=new u,q=new u,W=new u,D=new t,U=new t,B=new e;p.grazingAltitudeLocation=function(e,n){var i=e.origin,a=e.direction;if(!t.equals(i,t.ZERO)){var s=n.geodeticSurfaceNormal(i,S);if(t.dot(a,s)>=0)return i}var c=r(this.rayEllipsoid(e,n)),h=n.transformPositionToScaledSpace(a,S),l=t.normalize(h,h),f=t.mostOrthogonalAxis(h,T),d=t.normalize(t.cross(f,l,b),b),p=t.normalize(t.cross(l,d,I),I),g=L;g[0]=l.x,g[1]=l.y,g[2]=l.z,g[3]=d.x,g[4]=d.y,g[5]=d.z,g[6]=p.x,g[7]=p.y,g[8]=p.z;var y=u.transpose(g,A),v=u.fromScale(n.radii,C),w=u.fromScale(n.oneOverRadii,N),M=z;M[0]=0,M[1]=-a.z,M[2]=a.y,M[3]=a.z,M[4]=0,M[5]=-a.x,M[6]=-a.y,M[7]=a.x,M[8]=0;var x,_,O=u.multiply(u.multiply(y,w,q),M,q),E=u.multiply(u.multiply(O,v,W),g,W),R=u.multiplyByVector(O,i,P),k=m(E,t.negate(R,S),0,0,1),V=k.length;if(V>0){for(var X=t.clone(t.ZERO,U),j=Number.NEGATIVE_INFINITY,Y=0;Y<V;++Y){x=u.multiplyByVector(v,u.multiplyByVector(g,k[Y],D),D);var Z=t.normalize(t.subtract(x,i,T),T),G=t.dot(Z,a);G>j&&(j=G,X=t.clone(x,X))}var F=n.cartesianToCartographic(X,B);return j=o.clamp(j,0,1),_=t.magnitude(t.subtract(X,i,T))*Math.sqrt(1-j*j),_=c?-_:_,F.height=_,n.cartographicToCartesian(F,new t)}};var k=new t;return p.lineSegmentPlane=function(e,n,i,a){r(a)||(a=new t);var u=t.subtract(n,e,k),s=i.normal,c=t.dot(s,u);if(!(Math.abs(c)<o.EPSILON6)){var h=t.dot(s,e),l=-(i.distance+h)/c;if(!(l<0||l>1))return t.multiplyByScalar(u,l,a),t.add(e,a,a),a}},p.trianglePlaneIntersection=function(e,n,r,i){var a=i.normal,o=i.distance,u=t.dot(a,e)+o<0,s=t.dot(a,n)+o<0,c=t.dot(a,r)+o<0,h=0;h+=u?1:0,h+=s?1:0,h+=c?1:0;var l,f;if(1!==h&&2!==h||(l=new t,f=new t),1===h){if(u)return p.lineSegmentPlane(e,n,i,l),p.lineSegmentPlane(e,r,i,f),{positions:[e,n,r,l,f],indices:[0,3,4,1,2,4,1,4,3]};if(s)return p.lineSegmentPlane(n,r,i,l),p.lineSegmentPlane(n,e,i,f),{positions:[e,n,r,l,f],indices:[1,3,4,2,0,4,2,4,3]};if(c)return p.lineSegmentPlane(r,e,i,l),p.lineSegmentPlane(r,n,i,f),{positions:[e,n,r,l,f],indices:[2,3,4,0,1,4,0,4,3]}}else if(2===h){if(!u)return p.lineSegmentPlane(n,e,i,l),p.lineSegmentPlane(r,e,i,f),{positions:[e,n,r,l,f],indices:[1,2,4,1,4,3,0,3,4]};if(!s)return p.lineSegmentPlane(r,n,i,l),p.lineSegmentPlane(e,n,i,f),{positions:[e,n,r,l,f],indices:[2,0,4,2,4,3,1,3,4]};if(!c)return p.lineSegmentPlane(e,r,i,l),p.lineSegmentPlane(n,r,i,f),{positions:[e,n,r,l,f],indices:[0,1,4,0,4,3,2,3,4]}}},p.intersetRectangleWithConstraintRegion=function(t,e){if(!r(t)||!r(e))return-1;for(var n=Math.min(t.east,t.west),i=Math.max(t.east,t.west),a=Math.min(t.north,t.south),o=Math.max(t.north,t.south),u=0;u<e.length;u++){var s=e[u].constraintRegion,c=s[0],h=s[1],l=s[2],f=s[3],d=Math.abs(n+i-c-h),m=Math.abs(n-i)+Math.abs(c-h),p=Math.abs(a+o-l-f),g=Math.abs(a-o)+Math.abs(l-f);if(d<=m&&p<=g)return u;if(n>=c&&n<=h&&a>=l&&a<=f||c>=n&&c<=i&&l>=a&&l<=o)return u}return-1},p.isCartographicInConstraintRegion=function(t,e,n){if(!r(t||!r(n)))return-1;var i;if(r(e)&&-1!==e&&(i=n[e].constraintRegion,t.longitude>=i[0]&&t.longitude<=i[1]&&t.latitude>=i[2]&&t.latitude<=i[3]))return e;for(var a=0;a<n.length;a++)if(a!==e&&(i=n[a].constraintRegion,t.longitude>=i[0]&&t.longitude<=i[1]&&t.latitude>=i[2]&&t.latitude<=i[3]))return a;return-1},p}),define("Core/Cartesian2",["./Check","./defaultValue","./defined","./DeveloperError","./freezeObject","./Math"],function(t,e,n,r,i,a){"use strict";function o(t,n){this.x=e(t,0),this.y=e(n,0)}o.fromElements=function(t,e,r){return n(r)?(r.x=t,r.y=e,r):new o(t,e)},o.clone=function(t,e){if(n(t))return n(e)?(e.x=t.x,e.y=t.y,e):new o(t.x,t.y)},o.fromCartesian3=o.clone,o.fromCartesian4=o.clone,o.packedLength=2,o.pack=function(t,n,r){return r=e(r,0),n[r++]=t.x,n[r]=t.y,n},o.unpack=function(t,r,i){return r=e(r,0),n(i)||(i=new o),i.x=t[r++],i.y=t[r],i},o.packArray=function(t,e){var r=t.length;n(e)?e.length=2*r:e=new Array(2*r);for(var i=0;i<r;++i)o.pack(t[i],e,2*i);return e},o.unpackArray=function(t,e){var r=t.length;n(e)?e.length=r/2:e=new Array(r/2);for(var i=0;i<r;i+=2){var a=i/2;e[a]=o.unpack(t,i,e[a])}return e},o.fromArray=o.unpack,o.maximumComponent=function(t){return Math.max(t.x,t.y)},o.minimumComponent=function(t){return Math.min(t.x,t.y)},o.minimumByComponent=function(t,e,n){return n.x=Math.min(t.x,e.x),n.y=Math.min(t.y,e.y),n},o.maximumByComponent=function(t,e,n){return n.x=Math.max(t.x,e.x),n.y=Math.max(t.y,e.y),n},o.magnitudeSquared=function(t){return t.x*t.x+t.y*t.y},o.magnitude=function(t){return Math.sqrt(o.magnitudeSquared(t))};var u=new o;o.distance=function(t,e){return o.subtract(t,e,u),o.magnitude(u)},o.distanceSquared=function(t,e){return o.subtract(t,e,u),o.magnitudeSquared(u)},o.normalize=function(t,e){var n=o.magnitude(t);return e.x=t.x/n,e.y=t.y/n,e},o.dot=function(t,e){return t.x*e.x+t.y*e.y},o.multiplyComponents=function(t,e,n){return n.x=t.x*e.x,n.y=t.y*e.y,n},o.divideComponents=function(t,e,n){return n.x=t.x/e.x,n.y=t.y/e.y,n},o.add=function(t,e,n){return n.x=t.x+e.x,n.y=t.y+e.y,n},o.subtract=function(t,e,n){return n.x=t.x-e.x,n.y=t.y-e.y,n},o.multiplyByScalar=function(t,e,n){return n.x=t.x*e,n.y=t.y*e,n},o.divideByScalar=function(t,e,n){return n.x=t.x/e,n.y=t.y/e,n},o.negate=function(t,e){return e.x=-t.x,e.y=-t.y,e},o.abs=function(t,e){return e.x=Math.abs(t.x),e.y=Math.abs(t.y),e};var s=new o;o.lerp=function(t,e,n,r){return o.multiplyByScalar(e,n,s),r=o.multiplyByScalar(t,1-n,r),o.add(s,r,r)};var c=new o,h=new o;o.angleBetween=function(t,e){return o.normalize(t,c),o.normalize(e,h),a.acosClamped(o.dot(c,h))};var l=new o;return o.mostOrthogonalAxis=function(t,e){var n=o.normalize(t,l);return o.abs(n,n),e=n.x<=n.y?o.clone(o.UNIT_X,e):o.clone(o.UNIT_Y,e)},o.equals=function(t,e){return t===e||n(t)&&n(e)&&t.x===e.x&&t.y===e.y},o.equalsArray=function(t,e,n){return t.x===e[n]&&t.y===e[n+1]},o.equalsEpsilon=function(t,e,r,i){return t===e||n(t)&&n(e)&&a.equalsEpsilon(t.x,e.x,r,i)&&a.equalsEpsilon(t.y,e.y,r,i)},o.ZERO=i(new o(0,0)),o.UNIT_X=i(new o(1,0)),o.UNIT_Y=i(new o(0,1)),o.prototype.clone=function(t){return o.clone(this,t)},o.prototype.equals=function(t){return o.equals(this,t)},o.prototype.equalsEpsilon=function(t,e,n){return o.equalsEpsilon(this,t,e,n)},o.prototype.toString=function(){return"("+this.x+", "+this.y+")"},o}),define("Core/GeographicProjection",["./Cartesian3","./Cartographic","./defaultValue","./defined","./defineProperties","./DeveloperError","./Ellipsoid"],function(t,e,n,r,i,a,o){"use strict";function u(t){this._ellipsoid=n(t,o.WGS84),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis}return i(u.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),u.prototype.project=function(e,n){var i=this._semimajorAxis,a=e.longitude*i,o=e.latitude*i,u=e.height;return r(n)?(n.x=a,n.y=o,n.z=u,n):new t(a,o,u)},u.prototype.unproject=function(t,n){var i=this._oneOverSemimajorAxis,a=t.x*i,o=t.y*i,u=t.z;return r(n)?(n.longitude=a,n.latitude=o,n.height=u,n):new e(a,o,u)},u}),define("Core/GeographicTilingScheme",["./Cartesian2","./Check","./defaultValue","./defined","./defineProperties","./Ellipsoid","./GeographicProjection","./Math","./Rectangle"],function(t,e,n,r,i,a,o,u,s){"use strict";function c(t){t=n(t,{}),this._ellipsoid=n(t.ellipsoid,a.WGS84),this._rectangle=n(t.rectangle,s.MAX_VALUE),this._projection=new o(this._ellipsoid),this._numberOfLevelZeroTilesX=n(t.numberOfLevelZeroTilesX,2),this._numberOfLevelZeroTilesY=n(t.numberOfLevelZeroTilesY,1)}return i(c.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}}),c.prototype.getNumberOfXTilesAtLevel=function(t){return r(t)||(t=0),this._numberOfLevelZeroTilesX*Math.pow(2,t)},c.prototype.getNumberOfYTilesAtLevel=function(t){return r(t)||(t=0),this._numberOfLevelZeroTilesY*Math.pow(2,t)},c.prototype.rectangleToNativeRectangle=function(t,e){var n=u.toDegrees(t.west),i=u.toDegrees(t.south),a=u.toDegrees(t.east),o=u.toDegrees(t.north);return r(e)?(e.west=n,e.south=i,e.east=a,e.north=o,e):new s(n,i,a,o)},c.prototype.tileXYToNativeRectangle=function(t,e,n,r){var i=this.tileXYToRectangle(t,e,n,r);return i.west=u.toDegrees(i.west),i.south=u.toDegrees(i.south),i.east=u.toDegrees(i.east),i.north=u.toDegrees(i.north),i},c.prototype.tileXYToRectangle=function(t,e,n,i){var a=this._rectangle,o=this.getNumberOfXTilesAtLevel(n),u=this.getNumberOfYTilesAtLevel(n),c=a.width/o,h=t*c+a.west,l=(t+1)*c+a.west,f=a.height/u,d=a.north-e*f,m=a.north-(e+1)*f;return r(i)||(i=new s(h,m,l,d)),i.west=h,i.south=m,i.east=l,i.north=d,i},c.prototype.positionToTileXY=function(e,n,i){var a=this._rectangle;if(s.contains(a,e)){var o=this.getNumberOfXTilesAtLevel(n),c=this.getNumberOfYTilesAtLevel(n),h=a.width/o,l=a.height/c,f=e.longitude;a.east<a.west&&(f+=u.TWO_PI);var d=(f-a.west)/h|0;d>=o&&(d=o-1);var m=(a.north-e.latitude)/l|0;return m>=c&&(m=c-1),r(i)?(i.x=d,i.y=m,i):new t(d,m)}},c}),define("Workers/createHeightmapFromElevationLayers",["./createTaskProcessorWorker","../Core/Rectangle","../ThirdParty/when","../Core/Check","../Core/objectToQuery","../Core/IntersectionTests","../Core/defaultValue","../Core/defined","../Core/Cartographic","../Core/Ellipsoid","../Core/GeographicTilingScheme"],function(t,e,n,r,i,a,o,u,s,c,h){"use strict";function l(t){var e=new XMLHttpRequest;e.open("GET",t,!1),e.overrideMimeType("text/plain; charset=x-user-defined"),e.send(null);var n=e.getResponseHeader("Content-Type");if(n&&-1!==n.indexOf("null"))return null;if(200===e.status&&e.responseText&&!(e.responseText.length<100)){for(var r=e.responseText,i=r.length,a=new ArrayBuffer(i),o=new Uint8Array(a),u=0;u<i;++u){var s=r.charCodeAt(u),c=255&s;o[u]=c}return new Int16Array(a)}}function f(t){this.level=t.level,this.x=t.x,this.y=t.y,this.rectangle=t.rectangle}function d(t,n,r){if(this._samplesPerTile=o(r.samplesPerTile,150),this._templateUrl=r.urlTemplate,this._minLevel=o(r.minLevel,0),this._maxLevel=r.maxLevel,this._numTilesXAtMinLevel=r.numTilesXAtMinLevel,this._numTilesYAtMinLevel=r.numTilesYAtMinLevel,this._rectangle=new e(r.boundingBox.west,r.boundingBox.south,r.boundingBox.east,r.boundingBox.north),this._avaliablesByLevel=[],r.avaliables&&r.avaliables.length>0)for(var i=new h({ellipsoid:c.WGS84,rectangle:new e(r.boundingBox.west,r.boundingBox.south,r.boundingBox.east,r.boundingBox.north),numberOfLevelZeroTilesX:r.numTilesXAtMinLevel,numberOfLevelZeroTilesY:r.numTilesYAtMinLevel}),a=new e,s=new e,l=0;l<r.avaliables.length;++l){var f=r.avaliables[l],d=f.level;u(this._avaliablesByLevel[d])||(this._avaliablesByLevel[d]=[]),i.tileXYToRectangle(f.minX,f.minY,d,a),i.tileXYToRectangle(f.maxX,f.maxY,d,s),this._avaliablesByLevel[d].push(new e(a.west,s.south,s.east,a.north))}this._layerId=t,this._blackList=[],this._manager=n,this._bufferMap=new Map}function m(t,e){for(var n=t.length;n--;)if(t[n]===e)return!0;return!1}function p(){this._layers=[],this._index=0,this._maxBufferIndexArrayLength=500,this._bufferIndexArray=[]}function g(t,e){return t.timestamp<e.timestamp?-1:t.timestamp>e.timestamp?1:0}function y(t,n){if("addLayer"===t.method)return w.addLayer(t.layer),{succeed:!0};for(var r=new e(t.west,t.south,t.east,t.north),i=t.constraintRegions,o=a.intersetRectangleWithConstraintRegion(r,i),u=t.heightmapWidth,c=u/e.computeWidth(r),h=e.computeWidth(r)/(u-1),l=e.computeHeight(r)/(u-1),f=u*u,d=new Float32Array(f),m=new s,p=0,g=0;g<u;g++)for(var y=0;y<u;y++){m.longitude=r.west+y*h,m.latitude=r.north-g*l,m.height=0;var M=!1;if(-1!==o){var x=a.isCartographicInConstraintRegion(m,o,i);-1!==x&&(d[p++]=i[x].height,M=!0)}if(!M){if(w.getElevation(m,c)===v.FAILED)return null;d[p++]=m.height}}return n.push(d.buffer),{heightmap:d.buffer}}var v={FAILED:0,INFERIOR:1,DESIRABLE:2};f.prototype.toString=function(){return this.level+"_"+this.x+"_"+this.y},d.prototype.getTileKey=function(t,n){var r=Math.pow(2,n-this._minLevel),i=this._numTilesXAtMinLevel*r,a=this._numTilesYAtMinLevel*r,o=e.computeWidth(this._rectangle)/i,u=e.computeHeight(this._rectangle)/a,s=Math.min(Math.floor((t.longitude-this._rectangle.west)/o),i-1),c=Math.min(Math.floor((this._rectangle.north-t.latitude)/u),a-1);return new f({level:n,x:s,y:c,rectangle:new e(this._rectangle.west+s*o,this._rectangle.north-(c+1)*u,this._rectangle.west+(s+1)*o,this._rectangle.north-c*u)})},d.prototype.getElevationAtTile=function(t,n){var r=n.toString();if(m(this._blackList,r))return!1;var i=this._bufferMap.get(r);if(i){var a=(new Date).getTime();this._manager.updateBufferIndex(this._layerId,r,a)}else{var o=this._templateUrl.replace("{TileMatrix}",n.level).replace("{TileRow}",n.y).replace("{TileCol}",n.x),u=l(o);if(void 0!==u)if(u){i=u,this._bufferMap.set(r,i);var a=(new Date).getTime();this._manager.insertBufferIndex(this._layerId,r,a)}else this._blackList.push(r)}if(!i)return!1;var s=(this._samplesPerTile-1)*(t.longitude-n.rectangle.west)/e.computeWidth(n.rectangle),c=(this._samplesPerTile-1)*(n.rectangle.north-t.latitude)/e.computeHeight(n.rectangle),h=Math.floor(s),f=Math.min(h+1,this._samplesPerTile-1),d=Math.floor(c),p=Math.min(d+1,this._samplesPerTile-1),g=i[d*this._samplesPerTile+h],y=i[d*this._samplesPerTile+f],v=i[p*this._samplesPerTile+h],w=i[p*this._samplesPerTile+f],M=s-h,x=c-d;return t.height=(g*(1-M)+y*M)*(1-x)+(v*(1-M)+w*M)*x,!0},d.prototype.getElevation=function(t,n,r){var i=v.FAILED;if(!e.contains(this._rectangle,t))return i;for(var a=this._samplesPerTile/(e.computeWidth(this._rectangle)/this._numTilesXAtMinLevel),o=this._minLevel;o<=this._maxLevel;++o){if(a>=n){i=v.DESIRABLE;break}a*=2}if(o>this._maxLevel){if(a<=r)return v.FAILED;o=this._maxLevel,i=v.INFERIOR}for(var u=!1,s=this._avaliablesByLevel[o],c=0;c<s.length;++c)if(e.contains(s[c],t)){u=!0;break}if(!u)return v.FAILED;var h=this.getTileKey(t,o);return this.getElevationAtTile(t,h)?i:v.FAILED},d.prototype.removeBufferData=function(t){this._bufferMap.delete(t)},p.prototype.addLayer=function(t){var e=this._index++,n=new d(e,this,t);this._layers.push(n)},p.prototype.getElevation=function(t,e){for(var n=v.FAILED,r=0;r<this._layers.length;++r){var i=this._layers[r].getElevation(t,e,0);if(i===v.DESIRABLE)return i;i===v.INFERIOR&&(n=i)}return n},p.prototype.insertBufferIndex=function(t,e,n){var r=this._bufferIndexArray,i=this._maxBufferIndexArrayLength;if(r.length===i){var a=r.shift();this.removeBufferData(a)}r.push({layerId:t,tileKey:e,timestamp:n})},p.prototype.removeBufferData=function(t){for(var e=this._layers,n=e.length,r=0;r<n;r++){var i=e[r];if(i._layerId===t.layerId){i.removeBufferData(t.tileKey);break}}},p.prototype.updateBufferIndex=function(t,e,n){for(var r=this._bufferIndexArray,i=r.length,a=0;a<i;a++){var o=r[a];if(o.layerId===t&&o.tileKey===e){o.timestamp=n,r.sort(g);break}}};var w=new p;return t(y)})}();